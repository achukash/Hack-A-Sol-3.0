<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game Analyzer</title>
    <link rel="stylesheet" href="/static/analysis_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body>
    <div class="container">
        <h1>Chess Game Analyzer</h1>

        <!-- Upload Section -->
        <form id="upload-form" action="/upload" method="post" enctype="multipart/form-data">
            <div class="drop-area" id="drop-area-win">
                <p>Drag & Drop win PGN file here, or click to select</p>
                <input type="file" id="win" name="win" accept=".pgn" style="display: none;" required>
                <span class="file-name" id="file-name-win"></span>
            </div>

            <div class="drop-area" id="drop-area-loss">
                <p>Drag & Drop loss PGN file here, or click to select</p>
                <input type="file" id="loss" name="loss" accept=".pgn" style="display: none;" required>
                <span class="file-name" id="file-name-loss"></span>
            </div>

            <input type="submit" value="Analyze" id="analyze-button" disabled>
            <div class="error-message" id="error-message"></div>
        </form>
    </div>

    <!-- Chess Game Analysis Section -->
     {% if win_data %}
    <div class="container">
        <h1>Chess Game Analysis</h1>
        <div class="grid-container">
            <div class="grid-item">
                <i class="fas fa-chess"></i>
                <span>Total Moves: {{ win_data['total_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-pawn"></i>
                <span>Opening Moves: {{ win_data['opening_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-knight"></i>
                <span>Midgame Moves: {{ win_data['midgame_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-queen"></i>
                <span>Endgame Moves: {{ win_data['endgame_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-bullseye"></i>
                <span>Tactical Opportunities: {{ win_data['tactical_opportunities'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-king"></i>
                <span>Checkmate Threats: {{ win_data['checkmate_threats'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-users"></i>
                <span>Piece Coordination: {{ win_data['piece_coordination'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-board"></i>
                <span>Weak Squares: {{ win_data['weak_squares'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-pawn"></i>
                <span>Passed Pawns: {{ win_data['passed_pawns'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-shield-alt"></i>
                <span>King Safety: {{ win_data['king_safety'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-balance-scale"></i>
                <span>Material Balance: {{ win_data['material_balance'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-cogs"></i>
                <span>Development: {{ win_data['development'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-map"></i>
                <span>Space Control: {{ win_data['space_control'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-pawn"></i>
                <span>Pawn Weaknesses: {{ win_data['pawn_weaknesses'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-bishop"></i>
                <span>Captures: {{ win_data['captures'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-rook"></i>
                <span>Checks: {{ win_data['checks'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-crown"></i>
                <span>Castles: {{ win_data['castles'] }}</span>
            </div>
        </div>
    </div>
    {% endif %}

    {% if loss_data %}
    <div class="container">
        <h1>Chess Game Analysis</h1>
        <div class="grid-container">
            <div class="grid-item">
                <i class="fas fa-chess"></i>
                <span>Total Moves: {{ loss_data['total_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-pawn"></i>
                <span>Opening Moves: {{ loss_data['opening_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-knight"></i>
                <span>Midgame Moves: {{ loss_data['midgame_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-queen"></i>
                <span>Endgame Moves: {{ loss_data['endgame_moves'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-bullseye"></i>
                <span>Tactical Opportunities: {{ loss_data['tactical_opportunities'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-king"></i>
                <span>Checkmate Threats: {{ loss_data['checkmate_threats'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-users"></i>
                <span>Piece Coordination: {{ loss_data['piece_coordination'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-board"></i>
                <span>Weak Squares: {{ loss_data['weak_squares'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-pawn"></i>
                <span>Passed Pawns: {{ loss_data['passed_pawns'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-shield-alt"></i>
                <span>King Safety: {{ loss_data['king_safety'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-balance-scale"></i>
                <span>Material Balance: {{ loss_data['material_balance'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-cogs"></i>
                <span>Development: {{ loss_data['development'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-map"></i>
                <span>Space Control: {{ loss_data['space_control'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-pawn"></i>
                <span>Pawn Weaknesses: {{ loss_data['pawn_weaknesses'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-bishop"></i>
                <span>Captures: {{ loss_data['captures'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-chess-rook"></i>
                <span>Checks: {{ loss_data['checks'] }}</span>
            </div>
            <div class="grid-item">
                <i class="fas fa-crown"></i>
                <span>Castles: {{ loss_data['castles'] }}</span>
            </div>
        </div>
    </div>
    {% endif %}

    <script>
        // JS to handle drag & drop functionality
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            e.target.classList.add('highlight');
        }

        function unhighlight(e) {
            e.target.classList.remove('highlight');
        }

        function handleDrop(e, inputElement, fileNameElement) {
            const dt = e.dataTransfer;
            const files = dt.files;
            inputElement.files = files; // Assign dropped files to input element
            displayFileName(files[0], fileNameElement); // Display file name
            validateForm(); // Validate form on file drop
        }

        function displayFileName(file, fileNameElement) {
            fileNameElement.textContent = `Uploaded: ${file.name}`;
        }

        function setupDropArea(dropAreaId, inputElementId, fileNameElementId) {
            const dropArea = document.getElementById(dropAreaId);
            const inputElement = document.getElementById(inputElementId);
            const fileNameElement = document.getElementById(fileNameElementId);

            dropArea.addEventListener('dragenter', highlight, false);
            dropArea.addEventListener('dragover', highlight, false);
            dropArea.addEventListener('dragleave', unhighlight, false);
            dropArea.addEventListener('drop', (e) => {
                preventDefaults(e);
                unhighlight(e);
                handleDrop(e, inputElement, fileNameElement);
            }, false);

            dropArea.addEventListener('click', () => inputElement.click());

            inputElement.addEventListener('change', (e) => {
                const files = e.target.files;
                displayFileName(files[0], fileNameElement); // Display file name on selection
                validateForm(); // Validate form on file selection
            });

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
        }

        function validateForm() {
            const player1File = document.getElementById('win').files.length > 0;
            const player2File = document.getElementById('loss').files.length > 0;
            const analyzeButton = document.getElementById('analyze-button');
            const errorMessage = document.getElementById('error-message');

            if (player1File && player2File) {
                analyzeButton.disabled = false;
                analyzeButton.style.opacity = 1;
                errorMessage.textContent = ''; // Clear error message
            } else {
                analyzeButton.disabled = true;
                analyzeButton.style.opacity = 0.5;
                errorMessage.textContent = 'Please upload both win and loss files.'; // Show error message
            }
        }

        // Setup drop areas for both the win and loss PGN files
        setupDropArea('drop-area-win', 'win', 'file-name-win');
        setupDropArea('drop-area-loss', 'loss', 'file-name-loss');
    </script>
</body>

</html>
